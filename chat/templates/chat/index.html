<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <title>Chat Rooms</title>
</head>
<body>
  <div align="center">
    random_persona_table<br>
    <input type="button" id="matching-start-input" value="決定"><br>
    <div id="announce-message"></div>
  </div>
  <script>
    room_name = "{{room_name}}"
    var matchingSocket = new WebSocket(
      'ws://' + window.location.host + '/ws/matching/' + room_name + '/'
    );

    matchingSocket.onclose = function(e) {
      console.error('Matching socket closed unexpectedly');
    };

    document.querySelector('#matching-start-input').onclick = function(e) {
      matchingSocket.send(JSON.stringify({
        'room_name': room_name,
      }));
      document.querySelector('#announce-message').innerHTML = 'マッチング中です… [' + room_name + ']';
    };

    matchingSocket.onmessage = function (e) {
      var matching_data = JSON.parse(e.data);
      var room_name = matching_data['room_name'];
      if (matching_data['is_first']) {
        var turn = 'F';
      } else {
        var turn = 'S';
      }
      window.location.pathname = '/chat/' + room_name + '/' + turn + '/';
    };
  </script>
</body>
</html>